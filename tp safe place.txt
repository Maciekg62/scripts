local Players = game:GetService("Players")
local Player = Players.LocalPlayer

local function teleportToSpawn()
	local Baseplate = Instance.new("Part", workspace)
	Baseplate.Anchored = true
	Baseplate.Size = Vector3.new(20, 1, 20)
	Baseplate.Position = Vector3.new(-21206, 97428, 36654)
	Baseplate.Name = "SafeBaseplate"
	Baseplate.Color = Color3.fromRGB(60, 60, 60)
	Baseplate.Material = Enum.Material.SmoothPlastic

	-- Znajdź obszar gracza
	local function getPlayerArea()
		local areas = workspace:WaitForChild("BuildingAreas")
		for _, area in ipairs(areas:GetChildren()) do
			if area:IsA("Model") and area:FindFirstChild("Player") then
				if area.Player:IsA("StringValue") and area.Player.Value == Player.Name then
					return area
				end
			end
		end
	end

	local area = getPlayerArea()
	if area and area:FindFirstChild("SpawnLocation") then
		local spawn = area.SpawnLocation
		spawn.CFrame = CFrame.new(-21206, 97428, 36654)
	end
end

local function setupCharacterListeners(character)
	character:WaitForChild("Humanoid").Died:Connect(function()
		task.wait(1) -- Poczekaj chwilę po śmierci
		local respawnConn
		respawnConn = Player.CharacterAdded:Connect(function(char)
			respawnConn:Disconnect()
			task.wait(0.5)
			if char:FindFirstChild("HumanoidRootPart") then
				char:WaitForChild("HumanoidRootPart").CFrame = CFrame.new(-21206, 97428, 36654)
			end
		end)
	end)
end

if Player.Character then
	setupCharacterListeners(Player.Character)
end

Player.CharacterAdded:Connect(setupCharacterListeners)
teleportToSpawn()
